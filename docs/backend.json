{
  "entities": {
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProfile",
      "type": "object",
      "description": "Represents a user's profile information.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user profile."
        },
        "username": {
          "type": "string",
          "description": "The user's chosen username."
        },
        "favoriteTank": {
          "type": "string",
          "description": "The user's favorite tank."
        },
        "favoriteRoles": {
          "type": "array",
          "description": "The user's favorite in-game roles.",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "username"
      ]
    },
    "Vote": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Vote",
      "type": "object",
      "description": "Represents a user's vote for a specific time slot.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the vote."
        },
        "userId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N Vote)"
        },
        "timeslot": {
          "type": "string",
          "description": "The time slot that the vote is for (e.g., '16:30')."
        },
        "voteValue": {
          "type": "boolean",
          "description": "Indicates whether the user is available (true) or not (false) for the given time slot."
        }
      },
      "required": [
        "id",
        "userId",
        "timeslot",
        "voteValue"
      ]
    },
    "ScheduledEvent": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ScheduledEvent",
      "type": "object",
      "description": "Represents a scheduled training session or tournament.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the scheduled event."
        },
        "name": {
          "type": "string",
          "description": "The name of the scheduled event (e.g., 'Training Session 1')."
        },
        "startTime": {
          "type": "string",
          "description": "The start time of the event.",
          "format": "date-time"
        },
        "endTime": {
          "type": "string",
          "description": "The end time of the event.",
          "format": "date-time"
        },
        "description": {
          "type": "string",
          "description": "A description of the event."
        }
      },
      "required": [
        "id",
        "name",
        "startTime",
        "endTime"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}/profile",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Stores user profile data.  Path-based authorization ensures only the user can access their profile.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/votes/{voteId}",
        "definition": {
          "entityName": "Vote",
          "schema": {
            "$ref": "#/backend/entities/Vote"
          },
          "description": "Stores user votes for time slots. Path-based authorization ensures only the user can access their votes.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "voteId",
              "description": "The unique identifier of the vote."
            }
          ]
        }
      },
      {
        "path": "/scheduledEvents/{eventId}",
        "definition": {
          "entityName": "ScheduledEvent",
          "schema": {
            "$ref": "#/backend/entities/ScheduledEvent"
          },
          "description": "Stores information about scheduled events. If access control is needed, consider adding an 'ownerId' field or a 'members' map.",
          "params": [
            {
              "name": "eventId",
              "description": "The unique identifier of the scheduled event."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to support user profiles, availability voting, and scheduled events with a focus on security, scalability, and ease of debugging. It leverages denormalization and structural segregation to achieve authorization independence and QAPs.\n\n**Authorization Independence:**\n\n*   `UserProfiles`: User profile data is stored under `/users/{userId}/profile`.  Since profile data is private to each user, path-based authorization is sufficient. No denormalization is needed here.\n*   `Votes`: Each user's votes are stored under `/users/{userId}/votes/{voteId}`. Each vote document contains the `timeslot` and `voteValue`. This structure makes authorization straightforward based on the `userId` in the path.\n\n**Structural Segregation:**\nThe structure separates user profiles, votes, and scheduled events into distinct collections to ensure homogeneous security postures.\n\n*   `/users/{userId}/profile`: Contains private user profile data, accessible only to the user (identified by `userId`).\n*   `/users/{userId}/votes/{voteId}`: Stores user votes, accessible only to the user who created the vote. This allows users to manage their own votes independently.\n*   `/scheduledEvents/{eventId}`: Contains information about scheduled events. Access to create, modify, or delete events can be controlled via a `members` map (if collaborative) or an `ownerId` field, but it depends on the security requirements for managing schedules. If public, read access can be granted to all authenticated users.\n\n**QAPs (Rules Are Not Filters):**\n\n*   The structure supports secure `list` operations by storing user data under their respective `userId`. Security rules can easily enforce that a user can only list their own profiles and votes.\n*   For scheduled events, if `list` operations need to be restricted (e.g., only members of a certain group can list events), a membership map can be added to the `scheduledEvent` document and included as denormalized authorization data.\n\nThis design prioritizes authorization independence by avoiding `get()` calls in security rules and enabling atomic operations. It achieves clarity by explicitly defining data ownership and access control through a consistent structure and naming conventions. By storing data in distinct collections based on access requirements, security rules can be simple and robust."
  }
}